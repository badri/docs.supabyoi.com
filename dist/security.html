<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Security - Supabyoi Docs</title>
  <link rel="stylesheet" href="output.css" />
</head>
<body class="bg-white text-gray-900">

  <!-- Navigation -->
  <nav class="sticky top-0 z-50 bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Left: Logo -->
        <div class="flex-shrink-0">
          <a href="index.html" class="text-lg font-bold text-gray-900 hover:text-emerald-600 transition-colors">Supabyoi Docs</a>
        </div>

        <!-- Desktop Nav -->
        <div class="hidden md:flex items-center space-x-6">
          <a href="getting-started.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">Getting Started</a>
          <a href="vm-setup.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">VM Setup</a>
          <a href="ssh-troubleshooting.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">SSH Troubleshooting</a>
          <a href="deployment.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">Deployment</a>
          <a href="features.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">Features</a>
          <a href="security.html" class="text-sm text-emerald-600 font-semibold">Security</a>
          <a href="faq.html" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors">FAQ</a>
        </div>

        <!-- Mobile hamburger -->
        <div class="md:hidden">
          <button id="menu-toggle" type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none" aria-label="Toggle menu">
            <svg id="icon-open" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg id="icon-close" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 bg-white">
      <div class="px-4 py-3 space-y-2">
        <a href="getting-started.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">Getting Started</a>
        <a href="vm-setup.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">VM Setup</a>
        <a href="ssh-troubleshooting.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">SSH Troubleshooting</a>
        <a href="deployment.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">Deployment</a>
        <a href="features.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">Features</a>
        <a href="security.html" class="block text-sm text-emerald-600 font-semibold py-1">Security</a>
        <a href="faq.html" class="block text-sm text-gray-600 hover:text-emerald-600 py-1 transition-colors">FAQ</a>
      </div>
    </div>
  </nav>

  <!-- Main layout -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex gap-12">

      <!-- Sticky TOC sidebar (hidden on mobile) -->
      <aside class="hidden lg:block w-56 flex-shrink-0">
        <div class="sticky top-24">
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">On this page</p>
          <nav class="space-y-1">
            <a href="#ssh-key-encryption" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">SSH Key Encryption</a>
            <a href="#vm-hardening" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Automatic VM Hardening</a>
            <a href="#instance-credentials" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Instance Credentials</a>
            <a href="#tls-everywhere" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">TLS Everywhere</a>
            <a href="#row-level-security" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Row-Level Security</a>
            <a href="#studio-authentication" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Studio Authentication</a>
            <a href="#config-file-security" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Config File Security</a>
            <a href="#log-security" class="block text-sm text-gray-500 hover:text-emerald-600 py-1 transition-colors">Log Security</a>
          </nav>
        </div>
      </aside>

      <!-- Page content -->
      <main class="max-w-4xl w-full min-w-0">

        <!-- Page header -->
        <div class="mb-10">
          <h1 class="text-4xl font-bold text-gray-900 mb-4">Security</h1>
          <p class="text-lg text-gray-600 leading-relaxed">
            Security is fundamental to how Supabyoi operates. Your infrastructure credentials and data are protected at every layer.
          </p>
        </div>

        <!-- SSH Key Encryption -->
        <section id="ssh-key-encryption" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">SSH Key Encryption</h2>
          <p class="text-gray-600 leading-relaxed">
            Private SSH keys are encrypted at rest using <strong class="text-gray-800">Supabase Vault</strong>, which uses AES-256 encryption via pgsodium. Keys are never stored in plaintext in the application database. The encryption key itself is managed by pgsodium and never exposed to the application layer.
          </p>
          <div class="mt-4 bg-emerald-50 border border-emerald-100 rounded-lg px-5 py-4">
            <p class="text-sm text-emerald-800">
              <strong>AES-256 via pgsodium</strong> — Supabase Vault leverages libsodium under the hood, providing authenticated encryption that detects tampering alongside the confidentiality guarantee.
            </p>
          </div>
        </section>

        <!-- Automatic VM Hardening -->
        <section id="vm-hardening" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Automatic VM Hardening</h2>
          <p class="text-gray-600 leading-relaxed mb-6">
            When you add a VM, Supabyoi automatically applies security hardening. You do not need to configure these manually.
          </p>
          <ul class="space-y-4">
            <li class="flex gap-4">
              <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
              <div>
                <p class="text-gray-800 font-medium">Dedicated user</p>
                <p class="text-gray-600 text-sm mt-1">A <code class="bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono">supabyoi</code> system user is created with limited privileges. Root access is not required for day-to-day operations after the initial setup.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
              <div>
                <p class="text-gray-800 font-medium">Randomized SSH port</p>
                <p class="text-gray-600 text-sm mt-1">SSH is moved from the default port 22 to a random port between 10,000 and 60,000, significantly reducing exposure to automated scanning and brute-force bots targeting the standard port.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
              <div>
                <p class="text-gray-800 font-medium">Firewall (UFW)</p>
                <p class="text-gray-600 text-sm mt-1">Only the ports necessary for operation are allowed inbound: the randomized SSH port, HTTP (80), and HTTPS (443). All other ports are blocked by default.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
              <div>
                <p class="text-gray-800 font-medium">Fail2ban</p>
                <p class="text-gray-600 text-sm mt-1">Brute-force SSH protection is enabled via Fail2ban. Repeated failed login attempts result in automatic IP banning.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
              <div>
                <p class="text-gray-800 font-medium">Automatic updates</p>
                <p class="text-gray-600 text-sm mt-1">Unattended security updates are enabled so that OS-level security patches are applied automatically without manual intervention.</p>
              </div>
            </li>
          </ul>
        </section>

        <!-- Instance Credentials -->
        <section id="instance-credentials" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Instance Credentials</h2>
          <p class="text-gray-600 leading-relaxed mb-4">
            PostgreSQL passwords, JWT secrets, and API keys are generated <strong class="text-gray-800">uniquely per instance</strong> and stored in Supabase Vault. After storage in the vault, credential values are nulled from the application database — they exist only in encrypted vault storage.
          </p>
          <p class="text-gray-600 leading-relaxed">
            Credentials are retrieved from the vault only when needed (for example, during deployment) and are never written to application logs.
          </p>
          <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
              <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">PostgreSQL</p>
              <p class="text-sm text-gray-700">Unique password per instance, stored encrypted</p>
            </div>
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
              <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">JWT Secrets</p>
              <p class="text-sm text-gray-700">Per-instance signing secrets, vault-only storage</p>
            </div>
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
              <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">API Keys</p>
              <p class="text-sm text-gray-700">Anon and service keys generated fresh per instance</p>
            </div>
          </div>
        </section>

        <!-- TLS Everywhere -->
        <section id="tls-everywhere" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">TLS Everywhere</h2>
          <p class="text-gray-600 leading-relaxed mb-5">
            All traffic to Supabyoi-managed instances is encrypted in transit.
          </p>
          <ul class="space-y-3">
            <li class="flex items-start gap-3">
              <svg class="flex-shrink-0 w-5 h-5 text-emerald-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <p class="text-gray-600 text-sm">Cloudflare Origin CA wildcard certificate (<code class="bg-gray-100 text-gray-800 px-1 py-0.5 rounded text-xs font-mono">*.supabyoi.com</code>) covers all instances with a 15-year validity period</p>
            </li>
            <li class="flex items-start gap-3">
              <svg class="flex-shrink-0 w-5 h-5 text-emerald-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <p class="text-gray-600 text-sm">HTTPS enforced on all endpoints — no unencrypted access to instance APIs</p>
            </li>
            <li class="flex items-start gap-3">
              <svg class="flex-shrink-0 w-5 h-5 text-emerald-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <p class="text-gray-600 text-sm">Cloudflare proxy provides DDoS mitigation and absorbs volumetric attacks before they reach your VM</p>
            </li>
            <li class="flex items-start gap-3">
              <svg class="flex-shrink-0 w-5 h-5 text-emerald-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <p class="text-gray-600 text-sm">HTTP requests are automatically redirected to HTTPS via nginx configuration</p>
            </li>
          </ul>
        </section>

        <!-- Row-Level Security -->
        <section id="row-level-security" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Row-Level Security</h2>
          <p class="text-gray-600 leading-relaxed mb-4">
            All database queries in the Supabyoi application are scoped to the authenticated user. Users can only access their own VMs and instances. This isolation is enforced at the database level via <strong class="text-gray-800">Supabase RLS policies</strong> — not just application-layer filtering.
          </p>
          <p class="text-gray-600 leading-relaxed">
            Even if there were a bug in the application code, the database would reject any query attempting to access another user's data. RLS policies provide a second line of defense independent of the application logic.
          </p>
          <div class="mt-5 bg-gray-50 rounded-lg border border-gray-100 p-5">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Example RLS policy</p>
            <pre class="text-sm text-gray-800 font-mono overflow-x-auto"><code>CREATE POLICY "Users can only access their own VMs"
  ON vms FOR ALL
  USING (auth.uid() = user_id);</code></pre>
          </div>
        </section>

        <!-- Studio Authentication -->
        <section id="studio-authentication" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Studio Authentication</h2>
          <p class="text-gray-600 leading-relaxed mb-4">
            Access to Supabase Studio is protected by an nginx <code class="bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono">auth_request</code> directive that validates user ownership before granting access. Only the instance owner can access their Studio dashboard.
          </p>
          <p class="text-gray-600 leading-relaxed">
            When a request arrives for the Studio interface, nginx forwards authentication details to the Supabyoi application, which verifies that the requesting user owns the instance. If the check fails, nginx returns a 401 response and the Studio interface is never reached.
          </p>
          <div class="mt-5 bg-gray-50 rounded-lg border border-gray-100 p-5">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">nginx auth_request flow</p>
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 text-sm text-gray-700">
              <span class="bg-white border border-gray-200 rounded px-3 py-1.5">Browser request</span>
              <svg class="w-4 h-4 text-gray-400 rotate-90 sm:rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              <span class="bg-white border border-gray-200 rounded px-3 py-1.5">nginx auth_request</span>
              <svg class="w-4 h-4 text-gray-400 rotate-90 sm:rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              <span class="bg-white border border-gray-200 rounded px-3 py-1.5">Ownership check</span>
              <svg class="w-4 h-4 text-gray-400 rotate-90 sm:rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              <span class="bg-emerald-50 border border-emerald-200 text-emerald-800 rounded px-3 py-1.5">Studio (200) or 401</span>
            </div>
          </div>
        </section>

        <!-- Config File Security -->
        <section id="config-file-security" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Config File Security</h2>
          <p class="text-gray-600 leading-relaxed mb-4">
            Deployment configuration files containing credentials are written with <code class="bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono">0600</code> permissions (owner-read-only) and deleted from the VM immediately after use.
          </p>
          <p class="text-gray-600 leading-relaxed">
            Config files are uploaded to <code class="bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono">/tmp/</code> with a unique deployment ID in the filename, making accidental access by other processes unlikely even in the brief window between write and delete.
          </p>
          <div class="mt-4 flex flex-col sm:flex-row gap-4">
            <div class="flex-1 bg-gray-50 border border-gray-100 rounded-lg p-4">
              <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Permissions</p>
              <p class="text-sm font-mono text-gray-800">chmod 0600 /tmp/deploy-&lt;id&gt;.json</p>
            </div>
            <div class="flex-1 bg-gray-50 border border-gray-100 rounded-lg p-4">
              <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Lifecycle</p>
              <p class="text-sm text-gray-700">Written immediately before deployment, deleted immediately after</p>
            </div>
          </div>
        </section>

        <!-- Log Security -->
        <section id="log-security" class="mb-12 scroll-mt-24">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-100">Log Security</h2>
          <p class="text-gray-600 leading-relaxed mb-4">
            A secret masking utility strips credential values from all log output, preventing accidental exposure in deployment logs or error messages.
          </p>
          <p class="text-gray-600 leading-relaxed">
            All sensitive values — database passwords, JWT secrets, API keys — are registered with the masker before any operation begins. If a credential value appears anywhere in a log line (stdout, stderr, or structured log fields), it is replaced with <code class="bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono">[REDACTED]</code> before the line is written to storage or displayed in the UI.
          </p>
          <div class="mt-5 bg-gray-50 rounded-lg border border-gray-100 p-5">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Example masked output</p>
            <pre class="text-sm font-mono text-gray-700 overflow-x-auto"><code>Setting up postgres user... password=[REDACTED]
JWT_SECRET=[REDACTED]
ANON_KEY=[REDACTED]
Service role key=[REDACTED]</code></pre>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="border-t border-gray-200 py-8 mt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <p class="text-sm text-gray-500">Built by Supabyoi</p>
        <div class="flex items-center gap-6">
          <a href="https://app.supabyoi.com" class="text-sm text-gray-500 hover:text-emerald-600 transition-colors">app.supabyoi.com</a>
          <a href="https://supabyoi.com" class="text-sm text-gray-500 hover:text-emerald-600 transition-colors">supabyoi.com</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    const toggle = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-menu');
    const iconOpen = document.getElementById('icon-open');
    const iconClose = document.getElementById('icon-close');

    toggle.addEventListener('click', function () {
      const isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden', !isHidden);
      iconOpen.classList.toggle('hidden', isHidden);
      iconClose.classList.toggle('hidden', !isHidden);
    });
  </script>

</body>
</html>
